(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],2:[function(require,module,exports){var Amenti={Hall:require("./hall.js"),Guide:require("./guide.js"),Room:require("./room.js"),sel:require("./sel.js")};window.amenti=Amenti},{"./guide.js":4,"./hall.js":5,"./room.js":6,"./sel.js":7}],3:[function(require,module,exports){var{EventEmitter}=require("events");class Base{constructor(opts){opts=opts||{};opts.id=opts.id||Math.floor((1+Math.random())*65536);opts.states=opts.states||["lock","open","close"];for(var opt in opts){this[opt]=opts[opt]}this._emitter=new EventEmitter({});this.state=this.states[0]}speak(msg,resource=false){this._emitter.emit(msg,resource);return Promise.resolve()}listen(msg,callback){this._emitter.on(`${msg}`,callback);return Promise.resolve()}once(msg,callback){this._emitter.once(msg,callback);return Promise.resolve()}ignore(msg,callback){this._emitter.removeListener(msg,callback);return Promise.resolve()}setState(state){var _current=this.state;var _state=this.states.includes(state);var self=this;if(!_state){throw new Error("The state you passed in was not a valid state.  Please use addState('*state*').")}if(state===_current){throw new Error(`Currently in state: ${state}`)}if(_current){self.speak(`${_current}:leaving`).then((()=>{self.speak(`${state}:entering`).then((()=>{self.state=state;self.speak(`${self.state}:entered`)}))}))}return Promise.resolve()}addState(state){this.states.push(state)}}module.exports=Base},{events:1}],4:[function(require,module,exports){"use strict";const Base=require("./base.js");class Guide extends Base{constructor(opts={}){opts.halls=opts.halls||{};super(opts)}route(trigger,callback){const self=this;self.listen(trigger,callback);function hashChange(){self.speak(location.hash.substr(1))}if(trigger&&location.hash.substr(2).length)hashChange();window.addEventListener("hashchange",hashChange,false)}open(){for(var hall in this.halls){this.halls[hall].open()}this.setState("open");return Promise.resolve()}close(){for(var hall in this.halls){this.halls[hall].close()}this.setState("close");return Promise.resolve()}}module.exports=Guide},{"./base.js":3}],5:[function(require,module,exports){"use strict";const Base=require("./base.js");class Hall extends Base{constructor(opts={}){opts.rooms=opts.rooms||{};super(opts)}open(){for(var room in this.rooms){const _current=this.rooms[room];_current.open()}this.setState("open");return Promise.resolve()}close(){for(var room in this.rooms){const _current=this.rooms[room];_current.close()}this.setState("close");return Promise.resolve()}}module.exports=Hall},{"./base.js":3}],6:[function(require,module,exports){"use strict";const Base=require("./base.js");const sel=require("./sel.js");class Room extends Base{constructor(opts={}){opts.selector=opts.selector||"body";opts.template=opts.template||"";opts.onOpen=opts.onOpen||false;opts.onBuild=opts.onBuild||false;opts.states=["lock","open","close","build"];super(opts)}open(){if(this.state==="open"){return this.build()}this.build().then((()=>{if(typeof this.onOpen=="function"){this.onOpen()}}));this.setState("open");return Promise.resolve()}close(){this.destroy();this.setState("close");return Promise.resolve()}build(){this.el=sel.get(this.selector);this.el.dataset.id=this.id;const tmp=document.createElement("DIV");tmp.innerHTML=this.template;this.el.innerHTML=tmp.innerHTML;if(typeof this.onBuild=="function"){this.onBuild()}return Promise.resolve()}destroy(){sel.get(this.selector).innerHTML=""}}module.exports=Room},{"./base.js":3,"./sel.js":7}],7:[function(require,module,exports){"use strict";class Sel{static dom(cb){document.addEventListener("DOMContentLoaded",function(event){cb.call(event)})}static get(selector){return document.querySelector(selector)}static getAll(selector){return document.querySelectorAll(selector)}static next(el){return el.nextElementSibling}static prev(el){return el.previousElementSibling}static add(el,_class){_class=_class.split(" ");_class.forEach((cl=>{el.classList.add(cl)}));return el.classList}static remove(el,_class){if(!el||!_class)return"";_class=_class.split(" ");_class.forEach((cl=>{el.classList.remove(cl)}));return el.classList}static has(el,_class){return el.classList.contains(_class)}static toggle(el,_class){return el.classList.toggle(_class)}}module.exports=Sel},{}]},{},[2]);
